#!/usr/bin/env python2

import sys
import time
import struct
import usb

VENDOR  = 0x1d50
PRODUCT = 0x6666

# Find and configure device
dev = None
while dev is None:
	dev = usb.core.find(idVendor=VENDOR, idProduct=PRODUCT)
	time.sleep(0.1)

if dev.is_kernel_driver_active(0) is True:
	dev.detach_kernel_driver(0)

manufacturer = usb.util.get_string(dev, 100, dev.iManufacturer)
product = usb.util.get_string(dev, 100, dev.iProduct)
serial = usb.util.get_string(dev, 100, dev.iSerialNumber)

print("Found {0} {1} with serial {2} on bus {3}:{4}".format(manufacturer, product, serial, dev.bus, dev.address))

dev.set_configuration()

# Send loopback text
s = "loopback"
print("Sending '{0}'".format(s))
dev.write(0x02, s, 0, 100)

# Read back loopback text
ret = dev.read(0x81, 8, 0, 0)
print("Received '{0}'".format(''.join([chr(x) for x in ret])))
